## Question 07

在 opensnoop 运行期间，尝试使用 bpftool 将其中一个链接固定到 BPF 文件系统，命令如下：

```sh
# 请将命令中的 116 替换为你通过 bpftool link list 命令看到的某一个链接 ID
$ bpftool link pin id 116 /sys/fs/bpf/mylink
```

操作完成后你会发现，即使终止 opensnoop 程序，这个链接以及对应的 eBPF 程序依然会保留在内核中，不会被卸载。

## Answer

1. 运行 opensnoop

```sh
$ opensnoop-bpfcc
```

2. 查看 link 

```sh
$ bpftool link list
...
14: tracing  prog 104
        prog_type tracing  attach_type trace_fexit
        target_obj_id 1  target_btf_id 40424
15: tracing  prog 105
        prog_type tracing  attach_type trace_fexit
        target_obj_id 1  target_btf_id 40422
16: tracing  prog 106
        prog_type tracing  attach_type trace_fexit
        target_obj_id 1  target_btf_id 40420
```

3. link pin

```sh
$ bpftool link pin id 14 /sys/fs/bpf/mylink
```

4. 停止运行 opensnoop

5. 查看内核中加载的 eBPF 程序

```sh
$ bpftool prog list
...
104: tracing  name __x64_sys_open  tag 3ee01422231d9ef5  gpl
        loaded_at 2025-12-24T15:22:10+0800  uid 0
        xlated 600B  jited 485B  memlock 4096B  map_ids 60
        btf_id 87
```

6. 删除 mylink

```sh
$ rm /sys/fs/bpf/mylink
```