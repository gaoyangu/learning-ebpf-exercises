## Question 01

请确认，通过 `bpftool` 导出某 eBPF 程序的翻译后字节码时，输出的指令条数与该程序在 `BPF_PROG_LOAD` 系统调用中 `insn_cnt` 字段的值是一致的。

## Answer

```c
bpf(BPF_PROG_LOAD, {prog_type=BPF_PROG_TYPE_KPROBE, insn_cnt=47, 
   insns=0x7408c9814000, license="GPL", ... prog_name="hello", ...
   expected_attach_type=BPF_CGROUP_INET_INGRESS, prog_btf_fd=3, ...}, 152) = 6
```

```sh
$ bpftool prog dump xlated name hello
int hello(void * ctx):
; int hello(void *ctx) {
   0: (bf) r6 = r1
   1: (b7) r1 = 0
...
; char message[12] = "Hello World";
  10: (63) *(u32 *)(r10 -40) = r1
  11: (18) r1 = 0x6f57206f6c6c6548
  13: (7b) *(u64 *)(r10 -48) = r1
...
; return 0;
  47: (b7) r0 = 0
  48: (95) exit
```

`insn_cnt=47` 是物理指令数，指 47 个 `struct bpf_insn` 结构体，是内核接收的实际指令数量。

反汇编中的 48 是 `PC 偏移量`，因 LD_IMM64 指令占用两个槽位并跳过部分 PC 号，导致其数值超过 `insn_cnt`。