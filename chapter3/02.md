## Question 02

运行 `chapter2` 中的 `hello-map.py`，使用 `bpftool` 检查加载的程序

## Answer

1. 运行
```sh
$ cd learning-ebpf/chapter2
$ ./hello-map.py
```

2. prog show
```sh
$ bpftool prog show name hello
91: kprobe  name hello  tag de24cf185ee252cd  gpl
        loaded_at 2025-12-16T10:09:16+0800  uid 0
        xlated 208B  jited 131B  memlock 4096B  map_ids 51
        btf_id 105
```

3. prog dump

```sh
$ bpftool prog dump xlated name hello
int hello(void * ctx):
; uid = bpf_get_current_uid_gid() & 0xFFFFFFFF;
   0: (85) call bpf_get_current_uid_gid#213888
; uid = bpf_get_current_uid_gid() & 0xFFFFFFFF;
   1: (67) r0 <<= 32
   2: (77) r0 >>= 32
; uid = bpf_get_current_uid_gid() & 0xFFFFFFFF;
   3: (7b) *(u64 *)(r10 -8) = r0
; p = bpf_map_lookup_elem((void *)bpf_pseudo_fd(1, -1), &uid);
   4: (18) r1 = map[id:51]
   6: (bf) r2 = r10
;
   7: (07) r2 += -8
; p = bpf_map_lookup_elem((void *)bpf_pseudo_fd(1, -1), &uid);
   8: (85) call __htab_map_lookup_elem#244160
   9: (15) if r0 == 0x0 goto pc+1
  10: (07) r0 += 56
  11: (b7) r1 = 1
; if (p != 0) {
  12: (15) if r0 == 0x0 goto pc+2
; counter = *p;
  13: (79) r1 = *(u64 *)(r0 +0)
; counter++;
  14: (07) r1 += 1
  15: (7b) *(u64 *)(r10 -16) = r1
; bpf_map_update_elem((void *)bpf_pseudo_fd(1, -1), &uid, &counter, BPF_ANY);
  16: (18) r1 = map[id:51]
  18: (bf) r2 = r10
; counter++;
  19: (07) r2 += -8
  20: (bf) r3 = r10
  21: (07) r3 += -16
; bpf_map_update_elem((void *)bpf_pseudo_fd(1, -1), &uid, &counter, BPF_ANY);
  22: (b7) r4 = 0
  23: (85) call htab_map_update_elem#256400
; return 0;
  24: (b7) r0 = 0
  25: (95) exit
```
