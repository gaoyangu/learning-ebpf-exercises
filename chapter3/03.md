## Question 03

运行 `chapter2` 中的 `hello-tail.py`，使用 `bpftool` 检查加载的程序。

## Answer

1. 运行

```sh
$ cd learning-ebpf/chapter2
$ ./hello-tail.py
```

2. prog show 

```sh
$ bpftool prog show name hello
94: raw_tracepoint  name hello  tag 9b77eaf7d1a6840f  gpl
        loaded_at 2025-12-16T10:10:37+0800  uid 0
        xlated 160B  jited 173B  memlock 4096B  map_ids 52
        btf_id 107
95: raw_tracepoint  name ignore_opcode  tag a04f5eef06a7f555  gpl
        loaded_at 2025-12-16T10:10:37+0800  uid 0
        xlated 16B  jited 23B  memlock 4096B
        btf_id 107
96: raw_tracepoint  name hello_exec  tag d0e36209a2ef1b3e  gpl
        loaded_at 2025-12-16T10:10:37+0800  uid 0
        xlated 112B  jited 83B  memlock 4096B
        btf_id 107
97: raw_tracepoint  name hello_timer  tag 4db4fdc0ba974dc5  gpl
        loaded_at 2025-12-16T10:10:37+0800  uid 0
        xlated 352B  jited 214B  memlock 4096B
        btf_id 107
```

3. prog dump

```sh
$ bpftool prog dump xlated name hello
int hello(struct bpf_raw_tracepoint_args * ctx):
; int opcode = ctx->args[1];
   0: (79) r6 = *(u64 *)(r1 +8)
; bpf_tail_call_((void *)bpf_pseudo_fd(1, -1), ctx, opcode);
   1: (18) r2 = map[id:52]
; ((void (*)(void *, u64, int))BPF_FUNC_tail_call)(ctx, (u64)map_fd, index);
   3: (bf) r3 = r6
   4: (85) call bpf_tail_call#12
   5: (b7) r1 = 6563104
; ({ char _fmt[] = "Another syscall: %d"; bpf_trace_printk_(_fmt, sizeof(_fmt), opcode); });
   6: (63) *(u32 *)(r10 -16) = r1
   7: (18) r1 = 0x3a6c6c6163737973
   9: (7b) *(u64 *)(r10 -24) = r1
  10: (18) r1 = 0x20726568746f6e41
  12: (7b) *(u64 *)(r10 -32) = r1
  13: (bf) r1 = r10
;
  14: (07) r1 += -32
; ({ char _fmt[] = "Another syscall: %d"; bpf_trace_printk_(_fmt, sizeof(_fmt), opcode); });
  15: (b7) r2 = 20
  16: (bf) r3 = r6
  17: (85) call bpf_trace_printk#-82848
; return 0;
  18: (b7) r0 = 0
  19: (95) exit
```